<!doctype html>
<html lang="en">

<head>
    <title>ParticleLife</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />

    <script>
        function get(id) {
            return document.getElementById(id);
        }
    </script>
</head>

<body onload="">
    <div class="container m-2 p-2">
        <div class="row">
            <div class="col">
                <canvas id="display"></canvas>
            </div>
            <div class="col">
                <div class="container">
                    <div class="row">
                        <h2 class="text-center">Particle Life</h2>
                    </div>
                    <div class="row">
                        <button id="scene_randomize" class="m-3 p-2">Randomize</button>
                    </div>
                    <div class="row">
                        <button id="simulation_toggle" class="m-3 p-2">Toggle</button>
                    </div>
                    <div class="row">
                        <label class="mx-2">Number of particles</label>
                        <input id="simulation_particles_number" class="mx-3 p-1" type="range">
                    </div>
                    <div class="row">
                        <label class="mx-2">dt</label>
                        <input id="simulation_delta" class="mx-3 p-1" type="range">
                    </div>
                    <div class="row">
                        <label class="mx-2">Colors</label>
                        <input id="simulation_particles_colors" class="mx-3 p-1" type="text">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module">
        import { Vector2 } from "./vector2.js";
        import { Config } from "./config.js";
        import { Model } from "./model.js";


        const display = get("display");
        const context = display.getContext("2d");
        display.width = Config.display.size.x;
        display.height = Config.display.size.y;

        let timer
        const model = new Model(context);
        model.initialize();
        run();

        function run() {
            timer = setTimeout(run, Config.program.delta);
            model.update();
        }

        get("scene_randomize").addEventListener("click", () => model.scene.randomize(Config.simulation.particles.number));

        get("simulation_toggle").innerHTML = model.simulation.enabled ? "Pause" : "Start";
        get("simulation_toggle").addEventListener("click", () => { model.simulation.toggle(); get("simulation_toggle").innerHTML = model.simulation.enabled ? "Pause" : "Start" });

        get("simulation_particles_number").addEventListener("change", () => Config.simulation.particles.number = get("simulation_particles_number").value);
        get("simulation_particles_number").min = 0;
        get("simulation_particles_number").max = 20000;
        get("simulation_particles_number").value = Config.simulation.particles.number;

        get("simulation_delta").addEventListener("change", () => Config.simulation.physics.dt = get("simulation_delta").value / 10);
        get("simulation_delta").min = 0;
        get("simulation_delta").max = 50;
        get("simulation_delta").value = Config.simulation.physics.dt * 10;

        const getColors = () => { const colors = []; for (let color of Config.simulation.particles.colors) { colors.push(color); return colors; } };
        get("simulation_particles_colors").value = getColors();

    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>
</body>

</html>